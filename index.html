<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>HaKoi</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
    <script>
        $(document).ready(function () {

            window.orders = {
                "YOYOETH": 0.00053000,
                "VIBETH": 0.00085000,
                "POWRETH": 0.00156000,
                "ETHUSDT": 715
            }

            //start
            getPrice(start);

            function start() {
                setTimeout(function () {
                    getPrice(start);
                }, 5000);
            }

            function getPrice(callback) {
                $.getJSON({
                    url: "https://cors.io/?https://api.binance.com/api/v1/ticker/allPrices",
                    method: "GET",
                    success: function (body) {
                        var list = sanitize(body);
                        var calculated = calculate(list);
                        console.log(calculated);

                        //callback
                        if (callback) {
                            callback();
                        }
                    }
                })

                // $http.get('https://api.binance.com/api/v1/ticker/allPrices').then(function (body) {
                //     var list = sanitize(body);
                //     var calculated = calculate(list);
                //     console.log(calculated);

                //     //callback
                //     if (callback) {
                //         callback();
                //     }
                // });
            }

            function sanitize(list) {
                // var list = JSON.parse(list);
                var result = {};
                for (i = 0; i < list.length; i++) {
                    result[list[i].symbol] = parseFloat(list[i].price).toFixed(8);
                }
                return result;
            }

            function calculate(listPrice) {
                var result = '';

                $('body').html('');                
                for (p in orders) {
                    var name = p;
                    var buyAt = orders[p];
                    var currentPrice = listPrice[p];
                    var rate = ((listPrice[p] - orders[p]) * 100 / orders[p]).toFixed(2);

                    var newText = name + ' - At: ' + buyAt + ' | Current: ' + currentPrice + ' | Rate: ' + rate;
                    result = result + newText;
                    $('body').append("<p>" + newText + "</p>");
                }
                return result;
            }
        })
    </script>
</head>

<body>
    
</body>

</html>